clear;clc;
rp = 100e-9;
x = [4,6,8,10,12,14,16,20];
l = [402.1087, 429.5096, 458.2806, 485.6815, 514.4525, 541.8534, 569.2543, 621.3161] * 1e-9;
v = [6.3246E-04, 7.4848E-04, 7.6214E-04, 7.4321E-04, 7.0689E-04, 6.7155E-04, 6.3511E-04, 5.7362E-04];
r = [40.4, 40.1, 39.7, 39.4, 39.2, 38.9, 38.7, 38.4] * 1e-9;
k = [5.0519E-18, 8.3021E-18, 1.0335E-17, 1.1778E-17, 1.2549E-17, 1.3031E-17, 1.3244E-17, 1.3516E-17];
D = [8.3832E-10, 3.9926E-10, 3.6166E-10, 3.5211E-10, 3.8109E-10, 4.0779E-10, 4.7811E-10, 6.0927E-10];
c = (l ./ (l-2*rp) + l ./ (sqrt(2)*l-2*rp) * 4 + l ./ (sqrt(3)*l-2*rp) * 4) / 9;
k0 = (r .^ 4) ./ (l .^ 2) .* c;
D0 = l .* v;
y = D ./ D0;
cla;
plot(x, y, 'kx', 'MarkerSize', 10, 'Linewidth', 2);
hold on;
[xx, yy] = Uniform_BSpline(x, y, 3);
plot(xx, yy, 'r', 'Linewidth', 2);
p = polyfit(x(end-2:end), y(end-2:end), 1);
x3 = 0:26;
y3 = polyval(p, x3);
corr = corrcoef(x3, y3);
plot(x3, y3, 'g:', 'Linewidth', 2);
axis([0, 20, 0, 4]);
title('Coordination Number Function');
xlabel('Coordination Number \zeta');
ylabel('f_0(\zeta)');
text(11, 0.5, ['f_0(\zeta) = ', num2str(p(1), '%.2f'), '(\zeta - ', num2str(-p(2)/p(1), '%.2f'), ')'], 'Fontsize', 14);
legend('Simulation', 'B-Spline Fitting', 'Linear Continuation');